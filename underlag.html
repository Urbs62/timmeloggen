/* --- Öppna underlag (HTML) via localStorage (ingen lång URL) ---
const openUnderlagHtmlBtn = document.getElementById("openUnderlagHtmlBtn");
if (openUnderlagHtmlBtn) {
  openUnderlagHtmlBtn.addEventListener("click", () => {
    const monthVal = (document.getElementById("invoiceMonth")?.value || "").trim();
    if (!monthVal) return alert("Välj en månad.");

    const accVal = (document.getElementById("invoiceAccount")?.value || "ALL").trim();
    const { rows } = buildInvoiceRows(monthVal, accVal);
    if (!rows.length) return alert("Inga arbetspass hittades för vald månad/konto.");

    const accLabel =
      accVal === "ALL" ? "Alla konton" : (accountNameById(accVal) || accVal);

    // Minimal radmodell till underlaget
    const compactRows = rows.map(r => ({
      date: r.date,
      start: r.start,
      end: r.end,
      hours: r.hoursDec,
      text: r.text || ""
    }));

    // Lägg payload i localStorage
    const payload = {
      v: 1,
      createdAt: Date.now(),
      month: monthVal,
      account: accLabel,
      rows: compactRows
    };
    localStorage.setItem("tl_underlag_payload_v1", JSON.stringify(payload));

    // Öppna underlag.html med kort URL
    location.href = `underlag.html?from=ls`;
  });
}
